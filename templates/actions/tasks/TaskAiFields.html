<div class="dialog">
    <div class="dialog-background"></div>
    <div class="dialog-body">
        <a href="#" class="dialog-close js-close-dialog"><i class="fas fa-times"></i></a>
        <h3 class="dialog-header">[`Write task with AI`]</h3>
        <div class="dialog-content js-task-write-ai-content">
            <p class="hint">[`Кратко сформулируйте суть и цель задачи. ИИ напишет текст задачи или продолжит написанный вами текст.`]</p>
            <div class="dialog-ai-fields-container">
                <div class="flip-container">
                    <div class="dialog-ai-field-textarea">
                        <textarea name="objective" class="width-100"></textarea>
                    </div>

                    <div class="dialog-ai-field-items">
                        <button class="close-btn nobutton circle">
                            <i class="fas fa-exchange-alt fa-rotate-90 text-gray"></i>
                        </button>
                        <div class="fields">
                        {foreach $params.fields as $field}
                            {if $field.id == 'objective' || $field.id == 'context'}
                                {continue}
                            {/if}

                            <div class="content" id="{$field.id}">

                                <div class="field">
                                    <div class="value">
                                    <ul>
                                        {foreach $field.items|default:[] as $id => $val}
                                            <li>
                                            {if $field.type == 'radio'}
                                                <label>
                                                    <span class="wa-radio">
                                                        <input type="radio" name="{$field.id}" value="{$id}">
                                                        <span></span>
                                                    </span>
                                                    <span>{$val|escape}</span>
                                                </label>
                                            {/if}
                                            </li>
                                        {/foreach}
                                        </ul>
                                        {if $field.type == 'input'}
                                            <input type="text" name="{$id}" placeholder="{$field.example|escape}" value="{$val|escape}">
                                        {/if}
                                    </div>
                                </div>

                            </div>
                        {/foreach}
                        </div>
                    </div>
                </div>
            </div>

            <ul class="chips">
                {foreach $params.fields as $field}
                    {if $field.id == 'objective' || $field.id == 'context'}
                        {continue}
                    {/if}

                    <li data-param-id="{$field.id}">
                        <a href="javascript:void(0);">
                            {$field.title|escape}
                        </a>
                    </li>
                {/foreach}
            </ul>
        </div>
        <footer class="dialog-footer">
            <button class="js-write-ai-action button">[`Write with AI`]</button>
        </footer>
    </div>
    <script>
        $(document).ready(function() {
            const dialog = $('.dialog').data('dialog');

            $(".chips li").on("click", function () {

                if ($(this).hasClass("selected")) {
                    $(".dialog-ai-field-items .close-btn").trigger("click");
                    return;
                }

                const paramId = $(this).data("param-id");
                const $container = $(".dialog-ai-fields-container");
                $(this).addClass("selected").siblings("li").removeClass("selected");


                $container.addClass("flipped");

                $(".dialog-ai-field-items .content").removeClass("active");

                const $targetContent = $("#" + paramId);
                if ($targetContent.length) {
                    $targetContent.addClass("active");
                }
            });

            $(".dialog-ai-field-items .close-btn").on("click", function () {
                const $container = $(".dialog-ai-fields-container");

                $container.one("transitionend", function () {
                    $(".dialog-ai-field-items .content").removeClass("active");
                });

                $container.removeClass("flipped");
                $(".chips li").removeClass("selected");
            });

        });
    </script>
    <style>
        .dialog-ai-fields-container {
            perspective: 2000px;
            width: 100%;
            height: 200px;

            &.flipped .flip-container {
                transform: rotateX(180deg);
            }

            .flip-container {
                position: relative;
                width: 100%;
                height: 100%;
                transform-style: preserve-3d;
                transition: transform 0.6s ease-in-out;

                .dialog-ai-field-textarea, .dialog-ai-field-items {
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    backface-visibility: hidden;
                    box-sizing: border-box;
                }

                .dialog-ai-field-items {
                    background-color: var(--background-color-input);
                    border: 0.125em solid var(--border-color-input);
                    color: var(--text-color-input);
                    transform: rotateX(180deg);
                    overflow: auto;
                    border-radius: 0.5em;
                    padding: 1em;

                    .close-btn {
                        position: absolute;
                        top: 0.5em;
                        right: 0.5em;
                        z-index: 1;
                    }

                    .content {
                        display: none;

                        &.active {
                            display: block;
                        }
                    }
                }
            }
        }

    </style>
</div>
